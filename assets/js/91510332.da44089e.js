"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[36039],{15680:(e,n,t)=>{t.d(n,{xA:()=>p,yg:()=>h});var a=t(96540);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var c=a.createContext({}),s=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=s(e.components);return a.createElement(c.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(t),m=o,h=u["".concat(c,".").concat(m)]||u[m]||d[m]||i;return t?a.createElement(h,r(r({ref:n},p),{},{components:t})):a.createElement(h,r({ref:n},p))}));function h(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,r=new Array(i);r[0]=m;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l[u]="string"==typeof e?e:o,r[1]=l;for(var s=2;s<i;s++)r[s]=t[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},89540:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>u});t(96540);var a=t(15680);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function r(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}const l={title:"React useEffect Cleanup Function",description:"Understanding the cleanup function of the useEffect hook in React. Learn how to clean up side effects in React components to prevent memory leaks and improve performance.",slug:"useeffect-cleanup",authors:"peter_osah",tags:["react"],image:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2024-03-22-useeffect-cleanup/social.png",hide_table_of_contents:!1},c=void 0,s={permalink:"/blog/useeffect-cleanup",source:"@site/blog/2024-03-22-useeffect-cleanup.md",title:"React useEffect Cleanup Function",description:"Understanding the cleanup function of the useEffect hook in React. Learn how to clean up side effects in React components to prevent memory leaks and improve performance.",date:"2024-03-22T00:00:00.000Z",formattedDate:"March 22, 2024",tags:[{label:"react",permalink:"/blog/tags/react"}],readingTime:5.865,hasTruncateMarker:!1,authors:[{name:"Peter Osah",title:"Web Developer",imageURL:"/img/generic-profile.png",key:"peter_osah"}],frontMatter:{title:"React useEffect Cleanup Function",description:"Understanding the cleanup function of the useEffect hook in React. Learn how to clean up side effects in React components to prevent memory leaks and improve performance.",slug:"useeffect-cleanup",authors:"peter_osah",tags:["react"],image:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2024-03-22-useeffect-cleanup/social.png",hide_table_of_contents:!1},prevItem:{title:"Tailwind Animations with Examples",permalink:"/blog/tailwind-animations"},nextItem:{title:"Building a CRUD app with Shadcn UI and Refine",permalink:"/blog/shadcn-ui"},relatedPosts:[{title:"Create Full Featured Admin Panel with React and Ant Design",description:"We will see how easy it is to develop a functional Admin panel with the perfect harmony of Refine and Ant Design.",permalink:"/blog/refine-react-ant-design-admin-panel-framework",formattedDate:"February 21, 2022",authors:[{name:"Melih Ekinci",title:"Frontend Developer",url:"https://github.com/mlhekinci",imageURL:"https://github.com/mlhekinci.png",key:"melih"}],readingTime:12.565,date:"2022-02-21T00:00:00.000Z"},{title:"How to Build a React Admin Panel with Mantine and Strapi",description:"We'll be building a simple React Admin Panel with Refine and Mantine using Strapi as a backend service.",permalink:"/blog/react-admin-panel",formattedDate:"February 23, 2023",authors:[{name:"Joseph Mawa",title:"Web Developer",url:"https://github.com/nibble0101",imageURL:"/img/generic-profile.png",key:"joseph_mawa"}],readingTime:23.095,date:"2023-02-23T00:00:00.000Z"},{title:"A Guide on React Lazy Loading",description:"We will be looking at what lazy loading is, how it works, and how it can be used to improve the performance of React applications.",permalink:"/blog/react-lazy-loading",formattedDate:"December 7, 2022",authors:[{name:"Chidume Nnamdi",title:"Software Engineer",url:"https://github.com/philipszdavido",imageURL:"https://github.com/philipszdavido.png",key:"chidume_nnamdi"}],readingTime:9.85,date:"2022-12-07T00:00:00.000Z"}],authorPosts:[{title:"Building components with Radix UI",description:"This post explains with examples how the keyof operator is used to define advanced types in TypeScript.",permalink:"/blog/radix-ui",formattedDate:"April 4, 2024",authors:[{name:"Peter Osah",title:"Web Developer",imageURL:"/img/generic-profile.png",key:"peter_osah"}],readingTime:10.375,date:"2024-04-04T00:00:00.000Z"},{title:"Building a Complete React CRUD App with Airtable",description:"We will be building a Complete React CRUD application using Refine and Airtable, a famous backend service to illustrate how you can power your applications with refine.",permalink:"/blog/react-crud-app-airtable",formattedDate:"January 17, 2023",authors:[{name:"Peter Osah",title:"Web Developer",imageURL:"/img/generic-profile.png",key:"peter_osah"}],readingTime:29.64,date:"2023-01-17T00:00:00.000Z"},{title:"Tailwind Animations with Examples",description:"Understanding the cleanup function of the useEffect hook in React. Learn how to clean up side effects in React components to prevent memory leaks and improve performance.",permalink:"/blog/tailwind-animations",formattedDate:"March 25, 2024",authors:[{name:"Peter Osah",title:"Web Developer",imageURL:"/img/generic-profile.png",key:"peter_osah"}],readingTime:5.035,date:"2024-03-25T00:00:00.000Z"}]},p={authorsImageUrls:[void 0]},u=[{value:"Introduction",id:"introduction",level:2},{value:"What are \u201cside-effects\u201d?",id:"what-are-side-effects",level:2},{value:"Why cleanup \u201cside-effects\u201d?",id:"why-cleanup-side-effects",level:2},{value:"What is the <code>useEffect</code> cleanup function?",id:"what-is-the-useeffect-cleanup-function",level:2},{value:"What does <code>useEffect</code> function do?",id:"what-does-useeffect-function-do",level:2},{value:"When to use the <code>useEffect</code> cleanup function",id:"when-to-use-the-useeffect-cleanup-function",level:2},{value:"Fetch requests",id:"fetch-requests",level:3},{value:"Timeouts",id:"timeouts",level:3},{value:"Intervals",id:"intervals",level:3},{value:"Event Listeners",id:"event-listeners",level:3},{value:"Web sockets",id:"web-sockets",level:3},{value:"Conclusion.",id:"conclusion",level:2}],d={toc:u},m="wrapper";function h(e){var{components:n}=e,t=r(e,["components"]);return(0,a.yg)(m,i(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},a=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),a.forEach((function(n){o(e,n,t[n])}))}return e}({},d,t),{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h2",{id:"introduction"},"Introduction"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," hook is a popular hook that combines the functionality of ",(0,a.yg)("inlineCode",{parentName:"p"},"componentDidMount"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"componentDidUpdate"),", and ",(0,a.yg)("inlineCode",{parentName:"p"},"componentWillUnmount")," lifecycle methods of ",(0,a.yg)("inlineCode",{parentName:"p"},"React")," class components. The hook helps developers handle side effects in their programmes. Side effects may involve receiving data from an ",(0,a.yg)("strong",{parentName:"p"},"API"),", configuring ",(0,a.yg)("strong",{parentName:"p"},"event listeners"),", or subscribing to a ",(0,a.yg)("strong",{parentName:"p"},"WebSocket"),". All of these activities might influence the state of your application and may cause memory leaks if not taken care of."),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," hook comes with a cleanup function that cleans up effects to prevent memory leaks, which in turn improves the performance of the application. In this article, we will explain the cleanup function of the ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," hook."),(0,a.yg)("h2",{id:"what-are-side-effects"},"What are \u201cside-effects\u201d?"),(0,a.yg)("p",null,'A "',(0,a.yg)("strong",{parentName:"p"},"side effect"),'" is an operation that impacts something other than the function being executed.\nIn React, a side effect occurs when we impact something outside the scope of React in our ',(0,a.yg)("inlineCode",{parentName:"p"},"React")," components.\nA ",(0,a.yg)("strong",{parentName:"p"},"side effect")," could be retrieving data from a remote server, reading or writing to local storage, configuring event listeners, or creating a subscription. These side effects could also occur when a button is clicked, a form is submitted, or a component is mounted and unmounted."),(0,a.yg)("h2",{id:"why-cleanup-side-effects"},"Why cleanup \u201cside-effects\u201d?"),(0,a.yg)("p",null,"Cleaning up side effects in ",(0,a.yg)("inlineCode",{parentName:"p"},"React")," is a method of removing side effects that are no longer required. This, in turn, avoids ",(0,a.yg)("strong",{parentName:"p"},"memory leaks"),", which occur when your program or application attempts to perform an unnecessary operation or update a state memory location that no longer exists."),(0,a.yg)("h2",{id:"what-is-the-useeffect-cleanup-function"},"What is the ",(0,a.yg)("inlineCode",{parentName:"h2"},"useEffect")," cleanup function?"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," cleanup function is a return function within the ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," hook."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx"},'import React, { useEffect } from "React";\n\nuseEffect(() => {\n  // Your effect\n  return () => {\n    // Cleanup\n  };\n}, []);\n')),(0,a.yg)("h2",{id:"what-does-useeffect-function-do"},"What does ",(0,a.yg)("inlineCode",{parentName:"h2"},"useEffect")," function do?"),(0,a.yg)("p",null,"The function allows React developers to stop side effects that do not need to be executed before our component is unmounted."),(0,a.yg)("p",null,"For example, you have a ",(0,a.yg)("inlineCode",{parentName:"p"},"React")," component that performs a certain action in a ",(0,a.yg)("inlineCode",{parentName:"p"},"setTimeout"),". Every time the component is shown, it runs the ",(0,a.yg)("inlineCode",{parentName:"p"},"setTimeout")," function and performs the action in the timeout on that component.\nAssuming You decided to navigate away from this component and into another portion of the app. The component is no longer being rendered, thus there is no need to leave the ",(0,a.yg)("inlineCode",{parentName:"p"},"setTimeout")," function running in the background. However, the setTimeout function is still running in the background."),(0,a.yg)("p",null,"This is where the ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," cleaning function comes in. In the cleanup function, we can simply add a ",(0,a.yg)("inlineCode",{parentName:"p"},"clearTimeout")," which clears the timeout when the component is unmounted (i.e., no longer rendered)."),(0,a.yg)("h2",{id:"when-to-use-the-useeffect-cleanup-function"},"When to use the ",(0,a.yg)("inlineCode",{parentName:"h2"},"useEffect")," cleanup function"),(0,a.yg)("p",null,"There are various scenarios which will prompt the use of the ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," cleanup function. Thery are as follows:"),(0,a.yg)("h3",{id:"fetch-requests"},"Fetch requests"),(0,a.yg)("p",null,"When initiating an ",(0,a.yg)("strong",{parentName:"p"},"API")," request in a component, it is important that we also account for a way to abort the request when the component is unmounted or re-rendered.\nThere are several methods for canceling fetch request calls; we can use the native ",(0,a.yg)("inlineCode",{parentName:"p"},"fetch")," ",(0,a.yg)("inlineCode",{parentName:"p"},"AbortController")," or ",(0,a.yg)("inlineCode",{parentName:"p"},"Axios's")," ",(0,a.yg)("inlineCode",{parentName:"p"},"AbortController")," (If you are utilizing ",(0,a.yg)("inlineCode",{parentName:"p"},"Axios")," as our API Client)."),(0,a.yg)("p",null,"To utilise ",(0,a.yg)("inlineCode",{parentName:"p"},"AbortController"),", first, create a controller with the ",(0,a.yg)("inlineCode",{parentName:"p"},"AbortController()")," constructor. When our fetch request is initiated, we pass ",(0,a.yg)("inlineCode",{parentName:"p"},"signal")," as an option in the request's options object."),(0,a.yg)("p",null,"This associates the controller and signals with the fetch request, allowing us to cancel the request call at any time using the ",(0,a.yg)("inlineCode",{parentName:"p"},"AbortController.abort()")," method.\nWe will then add the ",(0,a.yg)("inlineCode",{parentName:"p"},"AbortController.abort()")," method to our ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," cleanup function to ensure that the request is aborted when the component is unmounted or re-rendered."),(0,a.yg)("p",null,"Examples of the useCases are displayed below:"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Fetch example:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx"},"useEffect(() => {\n  //create the abort controller\n  let controller = new AbortController();\n\n  (async () => {\n    try {\n      const response = await fetch(APIEndpoint, {\n        // attach the controller to the request\n        signal: controller.signal,\n      });\n      // add the sucess response to a state value\n    } catch (e) {\n      // Handle the error\n    }\n  })();\n  //abort the request when the component umounts\n  return () => controller?.abort();\n}, []);\n")),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Axios example:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx"},"useEffect(() => {\n  // create a controller\n  let controller = new AbortController();\n\n  (async () => {\n    try {\n      const response = await axios.get(APIEndpoint, {\n        // attach the controller to the request\n        signal: controller.signal,\n      });\n\n      // add the sucess response to a state value\n    } catch (e) {\n      // Handle the error\n    }\n  })();\n  //abort the request when the component umounts\n  return () => controller?.abort();\n}, []);\n")),(0,a.yg)("h3",{id:"timeouts"},"Timeouts"),(0,a.yg)("p",null,"For timeouts, you can use the ",(0,a.yg)("inlineCode",{parentName:"p"},"setTimeout(callback, timeInMs)")," timer function in the ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," hook, followed by the ",(0,a.yg)("inlineCode",{parentName:"p"},"clearTimeout(timerId)")," function in the cleanup function. This guarantees that the timer is cleared when the component is unmounted."),(0,a.yg)("p",null,"An example of this is displayed below:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx"},"useEffect(() => {\n  let timerId = setTimeout(() => {\n    // perform an action like state update\n    timerId = null;\n  }, 5000);\n\n  // clear the timer when component unmouts\n  return () => clearTimeout(timerId);\n}, []);\n")),(0,a.yg)("h3",{id:"intervals"},"Intervals"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"setInterval(callback, timeInMs)")," function can be declared in the ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," hook, and the ",(0,a.yg)("inlineCode",{parentName:"p"},"clearInterval(intervalId)")," function can be added to the cleanup function to handle intervals. By doing this, you can be sure that the timer will stop when the part is unmounted."),(0,a.yg)("p",null,"An example of this is displayed below:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx"},"useEffect(() => {\n  let intervalId = setInterval(() => {\n    // perform an action like state update\n    intervalId = null;\n  }, 5000);\n\n  // cleanup the interval when component unmounts\n  return () => clearInterval(interval);\n}, []);\n")),(0,a.yg)("h3",{id:"event-listeners"},"Event Listeners"),(0,a.yg)("p",null,"For event listeners, you can define them in the ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," callback by attaching the ",(0,a.yg)("inlineCode",{parentName:"p"},"addEventListener")," function to the element, and then cleanup the listeners by attaching the ",(0,a.yg)("inlineCode",{parentName:"p"},"removeEventListener")," function to the element on the ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," cleanup function. This guarantees that the listener is removed from the element when the component is mounted."),(0,a.yg)("p",null,"A simple usage of this is displayed in the example below, which is a custom hook for handling click events that occur outside of a certain ",(0,a.yg)("inlineCode",{parentName:"p"},"DOM")," element, such as a ",(0,a.yg)("inlineCode",{parentName:"p"},"div"),"."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx"},'const useOutsideClick = (callback: () => void) => {\n  const ref = useRef<HTMLElement>();\n\n  useEffect(() => {\n    const handleClick = (event: Event) => {\n      if (ref.current && !ref.current.contains(event.target as Node)) {\n        callback();\n      }\n    };\n\n    document.addEventListener("click", handleClick, true);\n\n    return () => {\n      document.removeEventListener("click", handleClick, true);\n    };\n  }, [callback, ref]);\n\n  return ref;\n};\n')),(0,a.yg)("h3",{id:"web-sockets"},"Web sockets"),(0,a.yg)("p",null,"For ",(0,a.yg)("strong",{parentName:"p"},"WebSockets"),", When you create a ",(0,a.yg)("strong",{parentName:"p"},"WebSocket")," connection in a component, you can close it when the component unmounts by including the ",(0,a.yg)("inlineCode",{parentName:"p"},"socket.close()")," method in the cleanup function."),(0,a.yg)("p",null,"An example of this is displayed below:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx"},"useEffect(() => {\n  const ws = new WebSocket(url, protocols);\n  // perform socket related actions\n\n  // cleanup web socket when component unmounts\n  return () => ws.close();\n}, []);\n")),(0,a.yg)("h2",{id:"conclusion"},"Conclusion."),(0,a.yg)("p",null,"In this article, we learned about side effects and how they create memory leaks and unwanted behaviors in ",(0,a.yg)("inlineCode",{parentName:"p"},"React")," components. We also looked at how to use the ",(0,a.yg)("inlineCode",{parentName:"p"},"useEffect")," cleanup function to fix memory leaks.\nUnderstanding how and when to repair memory leaks with the cleanup function is a significant step toward becoming a better React developer."))}h.isMDXComponent=!0}}]);