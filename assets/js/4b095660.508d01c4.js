"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[48495],{58860:(e,n,t)=>{t.d(n,{xA:()=>d,yg:()=>u});var a=t(37953);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},g=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=p(t),g=i,u=m["".concat(l,".").concat(g)]||m[g]||c[g]||o;return t?a.createElement(u,r(r({ref:n},d),{},{components:t})):a.createElement(u,r({ref:n},d))}));function u(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=g;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[m]="string"==typeof e?e:i,r[1]=s;for(var p=2;p<o;p++)r[p]=t[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}g.displayName="MDXCreateElement"},55162:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>p,toc:()=>m});t(37953);var a=t(58860);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){return n=null!=n?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})),e}function r(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}const s={title:"Implementing Role Based Access Control",description:"We'll implement Role Based Access Control (RBAC)",slug:"refine-pixels-6",authors:"abdullah_numan",tags:["refine-week","refine","supabase","access-control"],image:"https://refine.ams3.cdn.digitaloceanspaces.com/blog%2F2023-02-19-refine-pixels-6%2Fsocial.png",hide_table_of_contents:!1},l=void 0,p={permalink:"/blog/refine-pixels-6",source:"@site/blog/2023-02-19-refine-pixels-6.md",title:"Implementing Role Based Access Control",description:"We'll implement Role Based Access Control (RBAC)",date:"2023-02-19T00:00:00.000Z",formattedDate:"February 19, 2023",tags:[{label:"refine-week",permalink:"/blog/tags/refine-week"},{label:"refine",permalink:"/blog/tags/refine"},{label:"supabase",permalink:"/blog/tags/supabase"},{label:"access-control",permalink:"/blog/tags/access-control"}],readingTime:12.205,hasTruncateMarker:!1,authors:[{name:"Abdullah Numan",title:"Fullstack Developer",url:"https://github.com/anewman15/",imageURL:"https://github.com/anewman15.png",key:"abdullah_numan"}],frontMatter:{title:"Implementing Role Based Access Control",description:"We'll implement Role Based Access Control (RBAC)",slug:"refine-pixels-6",authors:"abdullah_numan",tags:["refine-week","refine","supabase","access-control"],image:"https://refine.ams3.cdn.digitaloceanspaces.com/blog%2F2023-02-19-refine-pixels-6%2Fsocial.png",hide_table_of_contents:!1},prevItem:{title:"Audit Log With Refine",permalink:"/blog/refine-pixels-7"},nextItem:{title:"Creating an Admin Dashboard with Refine",permalink:"/blog/refine-pixels-5"},relatedPosts:[{title:"NextAuth - Google And GitHub Authentications for Nextjs",description:"How to implement Google and GitHub authentications using NextAuth.js in Next.js?",permalink:"/blog/nextauth-google-github-authentication-nextjs",formattedDate:"June 21, 2024",authors:[{name:"Ekekenta Clinton",title:"Software Engineer",url:"https://github.com/icode247",imageURL:"https://github.com/icode247.png",key:"ekekenta_clinton"}],readingTime:16.355,date:"2024-06-21T00:00:00.000Z"},{title:"refine vs React-Admin Which is Better for Your Project?",description:"We will compare the features of Refine and react-admin",permalink:"/blog/refine-vs-react-admin",formattedDate:"November 26, 2021",authors:[{name:"Melih Ekinci",title:"Frontend Developer",url:"https://github.com/mlhekinci",imageURL:"https://github.com/mlhekinci.png",key:"melih"}],readingTime:14.425,date:"2021-11-26T00:00:00.000Z"},{title:"Build Access Control Mechanism using Permify",description:"We'll examine how to build an Access Control mechanism in Refine using Permify, an authorization as a service that helps you create any kind of authorization system easily with its panel.",permalink:"/blog/access-control",formattedDate:"January 9, 2024",authors:[{name:"Ege Ayt\u0131n",title:"Software Developer",url:"https://github.com/EgeAytin",imageURL:"https://github.com/EgeAytin.png",key:"ege"}],readingTime:10.66,date:"2024-01-09T00:00:00.000Z"}],authorPosts:[{title:"Creating an Admin Dashboard with Refine",description:"We'll be building a admin backend app for the Pixels client app.",permalink:"/blog/refine-pixels-5",formattedDate:"February 18, 2023",authors:[{name:"Abdullah Numan",title:"Fullstack Developer",url:"https://github.com/anewman15/",imageURL:"https://github.com/anewman15.png",key:"abdullah_numan"}],readingTime:18.84,date:"2023-02-18T00:00:00.000Z"},{title:"How to Use Two Dimensional Layouts with CSS Grid?",description:"We'll explore how to create two dimensional layouts using CSS Grid.",permalink:"/blog/css-grid",formattedDate:"July 17, 2024",authors:[{name:"Abdullah Numan",title:"Fullstack Developer",url:"https://github.com/anewman15/",imageURL:"https://github.com/anewman15.png",key:"abdullah_numan"}],readingTime:41.51,date:"2024-07-17T00:00:00.000Z"},{title:"Adding CRUD Actions and Authentication",description:"We'll initialize our Pixels app using Refine and get familiar with the boilerplate code to be created with the create refine-app CLI tool.",permalink:"/blog/refine-pixels-3",formattedDate:"February 16, 2023",authors:[{name:"Abdullah Numan",title:"Fullstack Developer",url:"https://github.com/anewman15/",imageURL:"https://github.com/anewman15.png",key:"abdullah_numan"}],readingTime:29.96,date:"2023-02-16T00:00:00.000Z"}]},d={authorsImageUrls:[void 0]},m=[{value:"RefineWeek series",id:"refineweek-series",level:3},{value:"Overview",id:"overview",level:2},{value:"Casbin with <strong>Refine</strong>",id:"casbin-with-refine",level:2},{value:"Casbin Installation",id:"casbin-installation",level:3},{value:"Browser Fallbacks for Casbin",id:"browser-fallbacks-for-casbin",level:4},{value:"Casbin Model and Policies",id:"casbin-model-and-policies",level:3},{value:"<code>&lt;Refine /&gt;</code>&#39;s <code>accessControlProvider</code>",id:"refine-s-accesscontrolprovider",level:2},{value:"<strong>Refine</strong> <code>can</code> Method",id:"refine-can-method",level:3},{value:"User Permissions with Supabase in Refine",id:"user-permissions-with-supabase-in-refine",level:2},{value:"Setting Up User Roles with Supabase Custom Claims",id:"setting-up-user-roles-with-supabase-custom-claims",level:3},{value:"<strong>Refine</strong> <code>getPermissions()</code> with Supabase Custom Claims",id:"refine-getpermissions-with-supabase-custom-claims",level:3},{value:"Refine <code>can</code> Method for Supabase Custom Roles",id:"refine-can-method-for-supabase-custom-roles",level:2},{value:"Low Level Inspection",id:"low-level-inspection",level:2},{value:"Summary",id:"summary",level:2}],c={toc:m},g="wrapper";function u(e){var{components:n}=e,t=r(e,["components"]);return(0,a.yg)(g,o(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},a=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),a.forEach((function(n){i(e,n,t[n])}))}return e}({},c,t),{components:n,mdxType:"MDXLayout"}),(0,a.yg)("p",null,"In this post, we implement Role Based Access Control (RBAC) on our ",(0,a.yg)("strong",{parentName:"p"},"Pixels Admin")," app. ",(0,a.yg)("strong",{parentName:"p"},"Pixels Admin")," serves as the admin dashboard of our ",(0,a.yg)("strong",{parentName:"p"},"Pixels")," client app that we built previously in the ",(0,a.yg)("a",{parentName:"p",href:"https://refine.dev/week-of-refine/"},(0,a.yg)("strong",{parentName:"a"},"RefineWeek"))," series."),(0,a.yg)("p",null,"This is Day 6, and ",(0,a.yg)("strong",{parentName:"p"},"RefineWeek")," is a seven-part tutorial that aims to help developers learn the ins-and-outs of ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/refinedev/refine"},(0,a.yg)("strong",{parentName:"a"},"Refine"),"'"),"s powerful capabilities and get going with ",(0,a.yg)("strong",{parentName:"p"},"Refine")," within a week."),(0,a.yg)("h3",{id:"refineweek-series"},"RefineWeek series"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Day 1 - ",(0,a.yg)("a",{parentName:"li",href:"https://refine.dev/blog/refine-pixels-1/"},"Pilot & Refine architecture")),(0,a.yg)("li",{parentName:"ul"},"Day 2 - ",(0,a.yg)("a",{parentName:"li",href:"https://refine.dev/blog/refine-pixels-2/"},"Setting Up the Client App")),(0,a.yg)("li",{parentName:"ul"},"Day 3 - ",(0,a.yg)("a",{parentName:"li",href:"https://refine.dev/blog/refine-pixels-3/"},"Adding CRUD Actions and Authentication")),(0,a.yg)("li",{parentName:"ul"},"Day 4 - ",(0,a.yg)("a",{parentName:"li",href:"https://refine.dev/blog/refine-pixels-4/"},"Adding Realtime Collaboration")),(0,a.yg)("li",{parentName:"ul"},"Day 5 - ",(0,a.yg)("a",{parentName:"li",href:"https://refine.dev/blog/refine-pixels-5/"},"Creating an Admin Dashboard with Refine")),(0,a.yg)("li",{parentName:"ul"},"Day 6 - ",(0,a.yg)("a",{parentName:"li",href:"https://refine.dev/blog/refine-pixels-6/"},"Implementing Role Based Access Control")),(0,a.yg)("li",{parentName:"ul"},"Day 7 - ",(0,a.yg)("a",{parentName:"li",href:"https://refine.dev/blog/refine-pixels-7/"},"Audit Log With Refine"))),(0,a.yg)("h2",{id:"overview"},"Overview"),(0,a.yg)("p",null,"On Day 5, we implemented CRUD functionalities on our dashboard resources: ",(0,a.yg)("inlineCode",{parentName:"p"},"users")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"canvases"),"."),(0,a.yg)("p",null,"Taking it farther today, we add authorization for actions related to ",(0,a.yg)("inlineCode",{parentName:"p"},"canvases")," resource at ",(0,a.yg)("inlineCode",{parentName:"p"},"/canvases")," route. We have have two roles that seek authorization: ",(0,a.yg)("inlineCode",{parentName:"p"},"editor")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"admin"),". An ",(0,a.yg)("inlineCode",{parentName:"p"},"editor")," is allowed to only promote and unpromote a ",(0,a.yg)("inlineCode",{parentName:"p"},"canvas"),", whereas an ",(0,a.yg)("inlineCode",{parentName:"p"},"admin")," is free to promote / unpromote a ",(0,a.yg)("inlineCode",{parentName:"p"},"canvas")," as well as delete it. Here's a short description of the specs:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("inlineCode",{parentName:"li"},"editor")," can promote and unpromote a canvas."),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("inlineCode",{parentName:"li"},"editor")," cannot perform any other action."),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("inlineCode",{parentName:"li"},"admin")," can promote and unpromote a canvas."),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("inlineCode",{parentName:"li"},"admin")," can delete a canvas."),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("inlineCode",{parentName:"li"},"admin")," cannot perform any other action.")),(0,a.yg)("p",null,"We manage RBAC and authorization using ",(0,a.yg)("a",{parentName:"p",href:"https://casbin.org/docs/overview"},(0,a.yg)("strong",{parentName:"a"},"Casbin"))," models and policies. We then make use of ",(0,a.yg)("strong",{parentName:"p"},"Refine"),"'s ",(0,a.yg)("inlineCode",{parentName:"p"},"accessControlProvider")," and associated hooks to enforce policies for these roles."),(0,a.yg)("p",null,"For the backend, we set and store ",(0,a.yg)("inlineCode",{parentName:"p"},"user")," roles with the help of ",(0,a.yg)("strong",{parentName:"p"},"Supabase Custom Claims"),". ",(0,a.yg)("strong",{parentName:"p"},"Supabase Custom Claims")," are a handy mechanism to store user roles information on the ",(0,a.yg)("inlineCode",{parentName:"p"},"auth.users")," table."),(0,a.yg)("p",null,"We also dig into some low level code in the ",(0,a.yg)("inlineCode",{parentName:"p"},"<DeleteButton />")," component that ",(0,a.yg)("strong",{parentName:"p"},"Refine"),"'s ",(0,a.yg)("strong",{parentName:"p"},"Ant Design")," package gives us to see how authorization comes baked into some of the related components."),(0,a.yg)("p",null,"Let's start with ",(0,a.yg)("strong",{parentName:"p"},"Casbin"),"."),(0,a.yg)("h2",{id:"casbin-with-refine"},"Casbin with ",(0,a.yg)("strong",{parentName:"h2"},"Refine")),(0,a.yg)("p",null,"In this app, we are implementing Role Based Access Control model with ",(0,a.yg)("strong",{parentName:"p"},"Casbin")," so we assume you are at least familiar with the RBAC related models and policies."),(0,a.yg)("p",null,"If you are not familiar with ",(0,a.yg)("strong",{parentName:"p"},"Casbin"),", please feel free to go through ",(0,a.yg)("a",{parentName:"p",href:"https://casbin.org/docs/how-it-works"},"how it works"),". For a complete beginner, I recommend understanding the following sections in the ",(0,a.yg)("strong",{parentName:"p"},"Casbin")," docs:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://casbin.org/docs/get-started"},"Get Started")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://casbin.org/docs/how-it-works"},"How It Works")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://casbin.org/docs/supported-models"},"Supported Models")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://casbin.org/docs/syntax-for-models"},"Syntax for Models")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://casbin.org/docs/model-storage"},"Model Storage")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://casbin.org/docs/policy-storage"},"Policy Storage")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://casbin.org/docs/enforcers"},"Enforcers")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://casbin.org/docs/adapters"},"Adapters")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://casbin.org/docs/role-managers"},"Role Managers")),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("a",{parentName:"li",href:"https://casbin.org/docs/rbac"},"RBAC"))),(0,a.yg)("p",null,"If / when you are familiar, lovely yay! Be with me, go ahead and install ",(0,a.yg)("strong",{parentName:"p"},"Casbin"),":"),(0,a.yg)("h3",{id:"casbin-installation"},"Casbin Installation"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"npm install casbin\n")),(0,a.yg)("h4",{id:"browser-fallbacks-for-casbin"},"Browser Fallbacks for Casbin"),(0,a.yg)("p",null,"We need to configure polyfills for ",(0,a.yg)("inlineCode",{parentName:"p"},"vite")," to work in a browser environment."),(0,a.yg)("p",null,"Let's first install required packages:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-node"},"npm install -D rollup-plugin-polyfill-node @esbuild-plugins/node-modules-polyfill @esbuild-plugins/node-globals-polyfill\n")),(0,a.yg)("p",null,"After that we need to add the following to the ",(0,a.yg)("inlineCode",{parentName:"p"},"vite.config.ts")," file:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="vite.config.ts"',title:'"vite.config.ts"'},'import { defineConfig } from "vite";\nimport react from "@vitejs/plugin-react";\n\nimport { NodeGlobalsPolyfillPlugin } from "@esbuild-plugins/node-globals-polyfill";\nimport { NodeModulesPolyfillPlugin } from "@esbuild-plugins/node-modules-polyfill";\nimport rollupNodePolyFill from "rollup-plugin-polyfill-node";\n\nexport default defineConfig({\n  plugins: [react()],\n  optimizeDeps: {\n    esbuildOptions: {\n      // Node.js global to browser globalThis\n      define: {\n        global: "globalThis",\n      },\n      // Enable esbuild polyfill plugins\n      plugins: [\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        NodeGlobalsPolyfillPlugin({\n          buffer: true,\n          process: true,\n        }),\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        NodeModulesPolyfillPlugin(),\n      ],\n    },\n  },\n  build: {\n    rollupOptions: {\n      plugins: [rollupNodePolyFill()],\n    },\n  },\n});\n')),(0,a.yg)("p",null,"Without these overrides, ",(0,a.yg)("inlineCode",{parentName:"p"},"casbin")," versions ",(0,a.yg)("inlineCode",{parentName:"p"},">5")," is known to throw errors."),(0,a.yg)("p",null,"With this out of the way and the ",(0,a.yg)("strong",{parentName:"p"},"Casbin")," model policies ready, it's time for us to define the ",(0,a.yg)("inlineCode",{parentName:"p"},"accessControlProvider"),"."),(0,a.yg)("h3",{id:"casbin-model-and-policies"},"Casbin Model and Policies"),(0,a.yg)("p",null,"We are using the following ",(0,a.yg)("inlineCode",{parentName:"p"},"model")," and policy ",(0,a.yg)("inlineCode",{parentName:"p"},"adapter")," for our RBAC implementation:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/casbin/accessControl.ts"',title:'"src/casbin/accessControl.ts"'},'import { newModel, StringAdapter } from "casbin";\n\nexport const model = newModel(`\n  [request_definition]\n  r = sub, obj, act\n\n  [policy_definition]\n  p = sub, obj, act\n\n  [role_definition]\n  g = _, _\n\n  [policy_effect]\n  e = some(where (p.eft == allow))\n\n  [matchers]\n  m = g(r.sub, p.sub) && keyMatch(r.obj, p.obj) && regexMatch(r.act, p.act)\n`);\n\nexport const adapter = new StringAdapter(`\n  p, admin, users, list\n  p, admin, canvases, (list)|(edit)|(delete)\n\n  p, editor, users, list\n  p, editor, canvases, (list)|(edit)\n`);\n')),(0,a.yg)("p",null,"A quick run down of the ",(0,a.yg)("inlineCode",{parentName:"p"},"model")," is:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"with the request definition in ",(0,a.yg)("inlineCode",{parentName:"li"},"r = sub, obj, act"),", ",(0,a.yg)("strong",{parentName:"li"},"Casbin")," scans the request for the subject (",(0,a.yg)("inlineCode",{parentName:"li"},"editor")," or ",(0,a.yg)("inlineCode",{parentName:"li"},"admin"),"), object (the ",(0,a.yg)("inlineCode",{parentName:"li"},"resource"),") and the action (",(0,a.yg)("inlineCode",{parentName:"li"},"get"),", ",(0,a.yg)("inlineCode",{parentName:"li"},"create"),", ",(0,a.yg)("inlineCode",{parentName:"li"},"edit"),", etc.)."),(0,a.yg)("li",{parentName:"ul"},"with the same parameters in ",(0,a.yg)("inlineCode",{parentName:"li"},"p = sub, obj, act"),", it compares the request parameters with those in the policy instances declared in the policy adapter"),(0,a.yg)("li",{parentName:"ul"},"with the two level grouping in ",(0,a.yg)("inlineCode",{parentName:"li"},"g = _, _"),", we are declaring user role inheritance can go two levels deep, i.e. an ",(0,a.yg)("inlineCode",{parentName:"li"},"admin")," is an ",(0,a.yg)("inlineCode",{parentName:"li"},"user"),".")),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"adapter")," holds our instances of policies produced from ",(0,a.yg)("inlineCode",{parentName:"p"},"p"),". The policies above basically allows:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"an ",(0,a.yg)("inlineCode",{parentName:"li"},"admin")," to ",(0,a.yg)("inlineCode",{parentName:"li"},"list")," users."),(0,a.yg)("li",{parentName:"ul"},"an admin to ",(0,a.yg)("inlineCode",{parentName:"li"},"list"),", ",(0,a.yg)("inlineCode",{parentName:"li"},"edit")," and ",(0,a.yg)("inlineCode",{parentName:"li"},"delete")," canvases."),(0,a.yg)("li",{parentName:"ul"},"an ",(0,a.yg)("inlineCode",{parentName:"li"},"editor")," to ",(0,a.yg)("inlineCode",{parentName:"li"},"list")," users."),(0,a.yg)("li",{parentName:"ul"},"an ",(0,a.yg)("inlineCode",{parentName:"li"},"editor")," to ",(0,a.yg)("inlineCode",{parentName:"li"},"list")," and ",(0,a.yg)("inlineCode",{parentName:"li"},"edit")," canvases.")),(0,a.yg)("h2",{id:"refine-s-accesscontrolprovider"},(0,a.yg)("inlineCode",{parentName:"h2"},"<Refine />"),"'s ",(0,a.yg)("inlineCode",{parentName:"h2"},"accessControlProvider")),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"<Refine />"),"'s ",(0,a.yg)("inlineCode",{parentName:"p"},"accessControlProvider")," is responsible for enforcing authorization on every request sent from the app. If we look at the ",(0,a.yg)("inlineCode",{parentName:"p"},"<App />")," component, we can see that it comes passed to the ",(0,a.yg)("inlineCode",{parentName:"p"},"<Refine />")," component with the boilerplate code:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/App.tsx"',title:'"src/App.tsx"'},"...\n<Refine\n    accessControlProvider={accessControlProvider}\n/>\n...\n")),(0,a.yg)("h3",{id:"refine-can-method"},(0,a.yg)("strong",{parentName:"h3"},"Refine")," ",(0,a.yg)("inlineCode",{parentName:"h3"},"can")," Method"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"accessControlProvider")," implements only one method named ",(0,a.yg)("inlineCode",{parentName:"p"},"can"),". It has the following type signature:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx"},"type CanParams = {\n  resource: string;\n  action: string;\n  params?: {\n    resource?: IResourceItem;\n    id?: BaseKey;\n    [key: string]: any;\n  };\n};\n")),(0,a.yg)("p",null,"Let's now work on the ",(0,a.yg)("inlineCode",{parentName:"p"},"can")," method. We can see from the type definition that ",(0,a.yg)("inlineCode",{parentName:"p"},"resource")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"action")," are compulsory."),(0,a.yg)("p",null,"Basic implementation of ",(0,a.yg)("inlineCode",{parentName:"p"},"can")," method looks like this:"),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"/docs/api-reference/core/providers/accessControl-provider/"},"Refer to the Access Control Provider documentation for more information. \u2192 ")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/providers/accessControlProvider.ts"',title:'"src/providers/accessControlProvider.ts"'},'import { newEnforcer } from "casbin";\nimport { CanParams, CanReturnType } from "@refinedev/core";\nimport { adapter, model } from "../casbin/accessControl";\n\nexport const accessControlProvider = {\n  can: async ({ resource, action }: CanParams): Promise<CanReturnType> => {\n    const enforcer = await newEnforcer(model, adapter);\n    const can = await enforcer.enforce("admin", resource, action);\n\n    return Promise.resolve({\n      can,\n    });\n  },\n};\n')),(0,a.yg)("p",null,"We will modify this gradually to witness the functionality facilitated out-of-the-box by ",(0,a.yg)("strong",{parentName:"p"},"Refine")," for each role defined in the policies. We will finalize it after we update the ",(0,a.yg)("inlineCode",{parentName:"p"},"getPermissions()")," method in ",(0,a.yg)("strong",{parentName:"p"},"Supabase")," ",(0,a.yg)("inlineCode",{parentName:"p"},"authProvider"),"."),(0,a.yg)("p",null,"But for now, notice in the above definition that we are passing the compulsory ",(0,a.yg)("inlineCode",{parentName:"p"},"resource")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"action")," parameters to ",(0,a.yg)("inlineCode",{parentName:"p"},"can"),". We expect the ",(0,a.yg)("inlineCode",{parentName:"p"},"useCan()")," access control hook to take these two arguments."),(0,a.yg)("p",null,"For more use cases and implementations of ",(0,a.yg)("inlineCode",{parentName:"p"},"can"),", feel free to go through the elaborate examples in ",(0,a.yg)("a",{parentName:"p",href:"https://refine.dev/docs/advanced-tutorials/access-control/"},"this definitive and guiding post"),"."),(0,a.yg)("p",null,"In the above code, we are initializing a ",(0,a.yg)("strong",{parentName:"p"},"Casbin")," ",(0,a.yg)("inlineCode",{parentName:"p"},"Enforcer")," with the ",(0,a.yg)("inlineCode",{parentName:"p"},"model")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"adapter"),". We want this ",(0,a.yg)("inlineCode",{parentName:"p"},"enforcer")," to enforce the policies with its accepted arguments. At the end, we get the ",(0,a.yg)("inlineCode",{parentName:"p"},"Boolean")," decision based on the model's policy effect."),(0,a.yg)("p",null,"From inside a component, the ",(0,a.yg)("inlineCode",{parentName:"p"},"accessControlProvider.can")," method will be invoked via the ",(0,a.yg)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/core/hooks/accessControl/useCan/"},(0,a.yg)("inlineCode",{parentName:"a"},"useCan()")," hook"),"."),(0,a.yg)("p",null,"With this code now, there should be no change in our UI. That is, we should be able to view the contents of both our ",(0,a.yg)("inlineCode",{parentName:"p"},"/users")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"/canvases")," resources like they were before. When we visit the ",(0,a.yg)("inlineCode",{parentName:"p"},"/canvases")," route, we should have all the buttons displayed."),(0,a.yg)("p",null,"We expect this behavior to change when we change the role. In the ",(0,a.yg)("inlineCode",{parentName:"p"},"can")," method above let's set the first argument of ",(0,a.yg)("inlineCode",{parentName:"p"},"enforcer.enforce()")," to ",(0,a.yg)("inlineCode",{parentName:"p"},'"editor"'),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx"},'const can = await enforcer.enforce("editor", resource, action);\n')),(0,a.yg)("p",null,"And if we refresh at ",(0,a.yg)("inlineCode",{parentName:"p"},"/canvases"),", we can see that the ",(0,a.yg)("inlineCode",{parentName:"p"},"Delete")," button on each row gets disabled."),(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-18-refine-pixels-5/can-access-disabled.jpg",alt:"react supabase CRUD App"}),(0,a.yg)("br",null),(0,a.yg)("p",null,"This is because now our policy for ",(0,a.yg)("inlineCode",{parentName:"p"},"editor")," has taken effect."),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"Delete")," button gets disabled because ",(0,a.yg)("inlineCode",{parentName:"p"},"@refinedev/antd"),"'s special buttons like the ",(0,a.yg)("inlineCode",{parentName:"p"},"<DeleteButton />")," are enabled or disabled based on the result of access control enforcement. Our ",(0,a.yg)("inlineCode",{parentName:"p"},"editor")," policies do not allow a ",(0,a.yg)("inlineCode",{parentName:"p"},"delete")," action on ",(0,a.yg)("inlineCode",{parentName:"p"},"canvases")," resource, so the ",(0,a.yg)("inlineCode",{parentName:"p"},"Delete")," button is disabled."),(0,a.yg)("p",null,"Visit ",(0,a.yg)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/core/providers/accessControl-provider/#buttons"},"this section")," of the ",(0,a.yg)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/core/providers/accessControl-provider/"},(0,a.yg)("inlineCode",{parentName:"a"},"accessControlProvider")," API reference")," for the complete list of buttons that check for and depend on user authorization state in ",(0,a.yg)("strong",{parentName:"p"},"Refine"),"."),(0,a.yg)("p",null,"At this point, we have manipulated the role with changes in our code. This should, however, come from the ",(0,a.yg)("inlineCode",{parentName:"p"},"authProvider"),"'s ",(0,a.yg)("inlineCode",{parentName:"p"},"getPermissions()")," method."),(0,a.yg)("p",null,"So, let's look how to get the roles from our ",(0,a.yg)("strong",{parentName:"p"},"Supabase")," database next."),(0,a.yg)("h2",{id:"user-permissions-with-supabase-in-refine"},"User Permissions with Supabase in Refine"),(0,a.yg)("p",null,"In ",(0,a.yg)("strong",{parentName:"p"},"Refine"),", user roles are fetched by ",(0,a.yg)("inlineCode",{parentName:"p"},"authProvider"),"'s ",(0,a.yg)("inlineCode",{parentName:"p"},"getPermissions()")," method. It is already defined for us by ",(0,a.yg)("inlineCode",{parentName:"p"},"@refinedev/supabase"),"."),(0,a.yg)("p",null,"When you bootstraped ",(0,a.yg)("strong",{parentName:"p"},"Refine")," app with CLI, the default ",(0,a.yg)("inlineCode",{parentName:"p"},"getPermissions")," method in ",(0,a.yg)("inlineCode",{parentName:"p"},"authProvider")," looks like below:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/providers/authProvider.ts"',title:'"src/providers/authProvider.ts"'},"getPermissions: async () => {\n  const user = await supabaseClient.auth.getUser();\n\n  if (user) {\n    return user.data.user?.role;\n  }\n\n  return null;\n};\n")),(0,a.yg)("p",null,"However, ",(0,a.yg)("strong",{parentName:"p"},"Supabase")," in itself does not support ",(0,a.yg)("strong",{parentName:"p"},"setting")," user roles to ",(0,a.yg)("inlineCode",{parentName:"p"},"users")," in the ",(0,a.yg)("inlineCode",{parentName:"p"},"auth.users")," table. So, it is not possible to set ",(0,a.yg)("inlineCode",{parentName:"p"},"editor")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"admin")," roles we need for our designated users. And only two role options are available to the front end app: ",(0,a.yg)("inlineCode",{parentName:"p"},"authenticated")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"anon"),"."),(0,a.yg)("p",null,"So, before we can use the ",(0,a.yg)("inlineCode",{parentName:"p"},"getPermissions()")," method, we have to set up custom user roles. One way to implement this is with ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/supabase-community/supabase-custom-claims"},(0,a.yg)("strong",{parentName:"a"},"Supabase Custom Claims")),"."),(0,a.yg)("h3",{id:"setting-up-user-roles-with-supabase-custom-claims"},"Setting Up User Roles with Supabase Custom Claims"),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Supabase Custom Claims")," is a community contribution that enables setting additional data to the access token that a user receives from ",(0,a.yg)("strong",{parentName:"p"},"Supabase"),". These claims are stored in the ",(0,a.yg)("inlineCode",{parentName:"p"},"auth.users.raw_app_meta_data")," field and is sent to the client with the access token. We are going to use these custom claims to set and retrieve user roles for our app."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Supabase")," does not support custom claims on its own. Due credits to ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/burggraf"},"@burggraf"),", they are enabled by installing a number of functions on our database. These functions allow us to set and get custom claims for a particular user in the ",(0,a.yg)("inlineCode",{parentName:"p"},"auth.users")," table."),(0,a.yg)("p",null,"Here are two crucial particulars on how they work:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Only a user with a ",(0,a.yg)("inlineCode",{parentName:"li"},"{ claims_admin: true }")," claim can set claims data on others. So we need to bootstrap a ",(0,a.yg)("inlineCode",{parentName:"li"},"claims_admin")," role for a first user using the ",(0,a.yg)("strong",{parentName:"li"},"Supabase")," SQL Editor."),(0,a.yg)("li",{parentName:"ul"},"Our app can access the getter and setter functions via ",(0,a.yg)("strong",{parentName:"li"},"Supabase")," Remote Procedure Calls (RPCs) with the ",(0,a.yg)("inlineCode",{parentName:"li"},"supabaseClient.rpc()")," method.")),(0,a.yg)("p",null,"With these in mind, let's go ahead and set up ",(0,a.yg)("strong",{parentName:"p"},"Supabase Custom Claims")," on our database."),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Installing Custom Claims Functions")),(0,a.yg)("p",null,"Let's start with installing the custom claims SQL functions. Copy, paste and run the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/supabase-community/supabase-custom-claims/blob/main/install.sql"},"install.sql")," script in your ",(0,a.yg)("strong",{parentName:"p"},"Supabase")," SQL Editor."),(0,a.yg)("p",null,"Take a note of the function named ",(0,a.yg)("inlineCode",{parentName:"p"},"get_my_claims()"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql",metastring:'title="https://github.com/supabase-community/supabase-custom-claims/blob/main/install.sql"',title:'"https://github.com/supabase-community/supabase-custom-claims/blob/main/install.sql"'},"CREATE OR REPLACE FUNCTION get_my_claims() RETURNS \"jsonb\"\n    LANGUAGE \"sql\" STABLE\n    AS $$\n  select\n    coalesce(nullif(current_setting('request.jwt.claims', true), '')::jsonb -> 'app_metadata', '{}'::jsonb)::jsonb\n")),(0,a.yg)("p",null,"This SQL function will help us to remotely get user roles for our app. And we are going to call it from our ",(0,a.yg)("inlineCode",{parentName:"p"},"getPermissions()")," method. To understand the details, please read through the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/supabase-community/supabase-custom-claims#getting-claims-data-from-the-server"},(0,a.yg)("strong",{parentName:"a"},"Supabhase Custom Claims")," page"),"."),(0,a.yg)("br",null),(0,a.yg)("p",null,(0,a.yg)("strong",{parentName:"p"},"Bootstrapping Claims Admin Role")),(0,a.yg)("p",null,"We then have to bootstrap a ",(0,a.yg)("inlineCode",{parentName:"p"},"claims_admin")," role because only users with ",(0,a.yg)("inlineCode",{parentName:"p"},"{ claims_admin: true }")," can set claims data for other users. This is necessary for security of the claims admin feature, and not for our app code. So, in the ",(0,a.yg)("strong",{parentName:"p"},"Supabase")," SQL Editor run the following query:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"select set_claim('designated-user-uuid', 'claims_admin', 'true');\n")),(0,a.yg)("p",null,"This will allow the user with id ",(0,a.yg)("inlineCode",{parentName:"p"},"designated-user-uuid")," to set roles for other users from inside our app."),(0,a.yg)("p",null,"We can also set other data from the SQL Editor, such as the role itself. Let's use the following SQL query to set roles for some of our designated users. Doing so will help us in the coming sections:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sql"},"select set_claim('designated-user-uuid', 'role', '\"editor\"');\nselect set_claim('another-designated-user-uuid', 'role', '\"admin\"');\n")),(0,a.yg)("p",null,"We need to take special care about using the correct quotations. More on this ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/supabase-community/supabase-custom-claims#set_claimuid-uuid-claim-text-value-jsonb-returns-text"},"in this section"),"."),(0,a.yg)("p",null,"With these done, we are ready to update our ",(0,a.yg)("inlineCode",{parentName:"p"},"getPermissions()")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"can")," methods."),(0,a.yg)("h3",{id:"refine-getpermissions-with-supabase-custom-claims"},(0,a.yg)("strong",{parentName:"h3"},"Refine")," ",(0,a.yg)("inlineCode",{parentName:"h3"},"getPermissions()")," with Supabase Custom Claims"),(0,a.yg)("p",null,"Here's the adjusted ",(0,a.yg)("inlineCode",{parentName:"p"},"getPermissions()")," method:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="providers/dataProvider.ts"',title:'"providers/dataProvider.ts"'},'getPermissions: async () => {\n    try {\n        const { error } = await supabaseClient.auth.getUser();\n\n        if (error) {\n            console.error(error);\n            return;\n        }\n\n        const { data } = await supabaseClient.rpc("get_my_claim", {\n            claim: "role",\n        });\n\n        return data;\n    } catch (error: any) {\n        console.error(error);\n        return;\n    }\n},\n')),(0,a.yg)("p",null,"Here, we are basically using the ",(0,a.yg)("inlineCode",{parentName:"p"},"supabaseClient.rpc()")," method to call the ",(0,a.yg)("inlineCode",{parentName:"p"},"get_my_claims")," SQL function remotely."),(0,a.yg)("h2",{id:"refine-can-method-for-supabase-custom-roles"},"Refine ",(0,a.yg)("inlineCode",{parentName:"h2"},"can")," Method for Supabase Custom Roles"),(0,a.yg)("p",null,"And now, we can finalize our ",(0,a.yg)("inlineCode",{parentName:"p"},"can")," method with ",(0,a.yg)("inlineCode",{parentName:"p"},"role")," received from ",(0,a.yg)("inlineCode",{parentName:"p"},"authProvider.getPermissions()"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="providers/accessControlProvider.ts"',title:'"providers/accessControlProvider.ts"'},'import { newEnforcer } from "casbin";\nimport { CanParams, CanReturnType } from "@refinedev/core";\n\nimport { adapter, model } from "../casbin/accessControl";\nimport { authProvider } from "./authProvider";\n\nexport const accessControlProvider = {\n  can: async ({ resource, action }: CanParams): Promise<CanReturnType> => {\n    const role = await authProvider.getPermissions?.();\n\n    const enforcer = await newEnforcer(model, adapter);\n    const can = await enforcer.enforce(role, resource, action);\n\n    return Promise.resolve({\n      can,\n    });\n  },\n};\n')),(0,a.yg)("p",null,"Earlier on, we have set ",(0,a.yg)("inlineCode",{parentName:"p"},"admin")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"editor")," roles for a few designated users using the ",(0,a.yg)("strong",{parentName:"p"},"Supabase")," SQL Editor. Now, logging into their respective accounts will display the dashboard with ",(0,a.yg)("strong",{parentName:"p"},"Casbin")," policies applied."),(0,a.yg)("p",null,"In the ",(0,a.yg)("inlineCode",{parentName:"p"},"/canvases")," route, an ",(0,a.yg)("inlineCode",{parentName:"p"},"editor")," account should have the ",(0,a.yg)("inlineCode",{parentName:"p"},"Delete")," buttons disabled because we don't have it in our policies."),(0,a.yg)("p",null,"In contrast, it is enabled for an ",(0,a.yg)("inlineCode",{parentName:"p"},"admin")," role:"),(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2023-02-18-refine-pixels-5/can-access-enabled.jpg",alt:"react supabase CRUD App"}),(0,a.yg)("br",null),(0,a.yg)("p",null,"But, wait! We haven't used the ",(0,a.yg)("inlineCode",{parentName:"p"},"useCan()")," hook or the ",(0,a.yg)("inlineCode",{parentName:"p"},"<CanAccess />")," component anywhere yet. How does ",(0,a.yg)("strong",{parentName:"p"},"Refine")," get the value of ",(0,a.yg)("inlineCode",{parentName:"p"},"role")," to decide whether to enable or disable the button? Let's find out next!"),(0,a.yg)("h2",{id:"low-level-inspection"},"Low Level Inspection"),(0,a.yg)("p",null,"If we dig into the ",(0,a.yg)("inlineCode",{parentName:"p"},"@refinedev/antd")," package for the ",(0,a.yg)("inlineCode",{parentName:"p"},"<DeleteButton />")," component, we can see that ",(0,a.yg)("inlineCode",{parentName:"p"},"useCan()")," hook is used to decide the authorization status:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="node_modules/@refinedev/antd/src/components/buttons/delete/index.ts"',title:'"node_modules/@refinedev/antd/src/components/buttons/delete/index.ts"'},'export const DeleteButton: React.FC<DeleteButtonProps> = ({\n    ...\n}) => {\n    ...\n\n    const { data } = useCan({\n        resource: resourceName,\n        action: "delete",\n        params: { id, resource },\n        queryOptions: {\n                enabled: accessControlEnabled,\n        },\n    });\n\n    if (accessControlEnabled && hideIfUnauthorized && !data?.can) {\n        return null;\n    }\n\n    ...\n};\n')),(0,a.yg)("p",null,"Since authorization comes baked in with ",(0,a.yg)("inlineCode",{parentName:"p"},"<DeleteButton />"),", we didn't have to worry about it in our case."),(0,a.yg)("h2",{id:"summary"},"Summary"),(0,a.yg)("p",null,"In this post, we implemented Role Based Access Control on ",(0,a.yg)("inlineCode",{parentName:"p"},"users")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"canvases")," resources using ",(0,a.yg)("strong",{parentName:"p"},"Refine"),"'s ",(0,a.yg)("inlineCode",{parentName:"p"},"accessControlProvider")," in our ",(0,a.yg)("strong",{parentName:"p"},"Pixels Admin")," app."),(0,a.yg)("p",null,"We used ",(0,a.yg)("strong",{parentName:"p"},"Casbin")," model and policies to enforce authorization for ",(0,a.yg)("inlineCode",{parentName:"p"},"editor")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"admin")," roles. We saw how the ",(0,a.yg)("inlineCode",{parentName:"p"},"accessControlProvider.can")," method is used to enforce ",(0,a.yg)("strong",{parentName:"p"},"Casbin")," policies based on roles fetched from the backend using the ",(0,a.yg)("inlineCode",{parentName:"p"},"authProvider.getPermissions")," method. We also learned how ",(0,a.yg)("strong",{parentName:"p"},"refine-antd")," buttons like the ",(0,a.yg)("inlineCode",{parentName:"p"},"<DeleteButton />")," implements access control via the ",(0,a.yg)("inlineCode",{parentName:"p"},"useCan()")," access hook."),(0,a.yg)("p",null,"In the next episode, we will explore the ",(0,a.yg)("inlineCode",{parentName:"p"},"auditLogProvider")," prop and add audit logging for ",(0,a.yg)("inlineCode",{parentName:"p"},"pixels")," activities to both our ",(0,a.yg)("strong",{parentName:"p"},"Pixels")," and ",(0,a.yg)("strong",{parentName:"p"},"Pixels Admin")," apps."),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"https://refine.dev/blog/refine-pixels-7/"},'Click here to read "Audit Log With Refine" article. ',"\u2192")))}u.isMDXComponent=!0}}]);