"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[80741],{58860:(e,t,n)=>{n.d(t,{xA:()=>u,yg:()=>m});var a=n(37953);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),d=r,m=c["".concat(l,".").concat(d)]||c[d]||g[d]||o;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},81087:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>p,toc:()=>c});n(37953);var a=n(58860);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const s={title:"OTP Authentication with Supabase and Twilio in React",description:"We'll implement OTP(SMS) authorization using Twilio and Supabase in React app.",slug:"supabase-twilio-otp-authentication-in-react",authors:"vijit_ail",tags:["react","supabase","refine","access-control","tutorial"],image:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/social.png",hide_table_of_contents:!1},l=void 0,p={permalink:"/blog/supabase-twilio-otp-authentication-in-react",source:"@site/blog/2022-09-22-refine-supabase-auth.md",title:"OTP Authentication with Supabase and Twilio in React",description:"We'll implement OTP(SMS) authorization using Twilio and Supabase in React app.",date:"2022-09-22T00:00:00.000Z",formattedDate:"September 22, 2022",tags:[{label:"react",permalink:"/blog/tags/react"},{label:"supabase",permalink:"/blog/tags/supabase"},{label:"refine",permalink:"/blog/tags/refine"},{label:"access-control",permalink:"/blog/tags/access-control"},{label:"tutorial",permalink:"/blog/tags/tutorial"}],readingTime:14.17,hasTruncateMarker:!1,authors:[{name:"Vijit Ail",title:"Software Engineer",url:"https://github.com/vijitail",imageURL:"https://github.com/vijitail.png",key:"vijit_ail"}],frontMatter:{title:"OTP Authentication with Supabase and Twilio in React",description:"We'll implement OTP(SMS) authorization using Twilio and Supabase in React app.",slug:"supabase-twilio-otp-authentication-in-react",authors:"vijit_ail",tags:["react","supabase","refine","access-control","tutorial"],image:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/social.png",hide_table_of_contents:!1},prevItem:{title:"An article guideline for Refine blog posts",permalink:"/blog/article-guideline"},nextItem:{title:"React 18 Upgrade Guide and New Features",permalink:"/blog/react-18-upgrade-guide"},relatedPosts:[{title:"Framer Motion examples for React animations",description:"Framer Motion tutorial - Create text and image animations in React apps easily.",permalink:"/blog/framer-motion-react-animations",formattedDate:"September 1, 2022",authors:[{name:"Joel Ezimorah",title:"Software Developer",url:"https://github.com/prince-joel",imageURL:"https://github.com/prince-joel.png",key:"joel_ezimorah"}],readingTime:8.235,date:"2022-09-01T00:00:00.000Z"},{title:"How to use Material UI Card Component",description:"We'll discover the Material UI Card component with examples",permalink:"/blog/material-ui-card",formattedDate:"December 26, 2024",authors:[{name:"Doro Onome",title:"Software Developer",url:"https://github.com/Nomzy-kush",imageURL:"https://github.com/Nomzy-kush.png",key:"doro_onome"}],readingTime:13.84,date:"2024-12-26T00:00:00.000Z"},{title:"Understanding Virtual DOM in React",description:"We'll dive into the concept of a virtual DOM in the React as well as explore its purpose.",permalink:"/blog/react-virtual-dom",formattedDate:"September 11, 2024",authors:[{name:"Peter Osah",title:"Web Developer",imageURL:"/img/generic-profile.png",key:"peter_osah"}],readingTime:14.895,date:"2024-09-11T00:00:00.000Z"}],authorPosts:[]},u={authorsImageUrls:[void 0]},c=[{value:"Introduction",id:"introduction",level:2},{value:"What is Supabase?",id:"what-is-supabase",level:2},{value:"What is Refine?",id:"what-is-refine",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Installing Tailwind CSS for Refine project",id:"installing-tailwind-css-for-refine-project",level:2},{value:"Set up the Supabase Project",id:"set-up-the-supabase-project",level:2},{value:"Create the Login Page",id:"create-the-login-page",level:2},{value:"Data Provider",id:"data-provider",level:2},{value:"Auth Provider",id:"auth-provider",level:2},{value:"Conclusion",id:"conclusion",level:2}],g={toc:c},d="wrapper";function m(e){var{components:t}=e,n=i(e,["components"]);return(0,a.yg)(d,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){r(e,t,n[t])}))}return e}({},g,n),{components:t,mdxType:"MDXLayout"}),(0,a.yg)("h2",{id:"introduction"},"Introduction"),(0,a.yg)("p",null,"Passwords are one of the most popular ways to authenticate a user. However, passwords have disadvantages, such as being subject to brute force attacks and data breaches."),(0,a.yg)("p",null,"Another significant problem with password-based login is that keeping track of different passwords can become challenging. This is where the term 'OTP' (One Time Password) can be helpful."),(0,a.yg)("p",null,"When we talk about OTP-based authentication, users need to enter a six-digit OTP number sent to them through an automated call or SMS when they want to access the application."),(0,a.yg)("p",null,"You can access the example app we'll be building in the article by following this ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/refinedev/refine/tree/main/examples/blog-refine-supabase-auth"},"link.")),(0,a.yg)("p",null,"Steps we'll cover:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"#what-is-supabase"},"What is Supabase?")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"#what-is-refine"},"What is Refine?")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"#prerequisites"},"Prerequisites")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"#getting-started"},"Getting Started")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"#installing-tailwind-css-for-refine-project"},"Installing Tailwind CSS for Refine project")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"#set-up-the-supabase-project"},"Set up the Supabase Project")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"#create-the-login-page"},"Create the Login Page")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"#data-provider"},"Data Provider")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"#auth-provider"},"Auth Provider"))),(0,a.yg)("h2",{id:"what-is-supabase"},"What is Supabase?"),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"https://supabase.com/"},"Supabase")," is an open-source Firebase alternative. It provides a real-time database, authentication, and media buckets in one platform. You can use Supabase with any frontend tool, such as React, Angular, or Vue.js."),(0,a.yg)("p",null,"One of the great features of Supabase is its Auth service. Supabase Auth allows you to easily add OTP-based authentication to your app with just a few lines of code."),(0,a.yg)("p",null,"In this guide, you will implement OTP-based login in ",(0,a.yg)("strong",{parentName:"p"},"Refine")," using the Supabase library."),(0,a.yg)("h2",{id:"what-is-refine"},"What is Refine?"),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"https://github.com/refinedev/refine"},"Refine")," is a React-based open-source frameworks for building admin panels, dashboards, internal tools and storefront apps rapidly. It helps developers to avoid from repetitive tasks demanded by CRUD operations and provides solutions for like authentication, access control, routing, networking, state management."),(0,a.yg)("p",null,"One of the great features of Refine is its out-of-the-box data providers integrations. Refine has a built-in data provider for supabase and we'll see how to use it properly."),(0,a.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.yg)("p",null,"To follow this guide, you must install the latest Node.js version on your system and be familiar with React and TypeScript concepts. For this tutorial, you will also require a Twilio account to send out OTP text messages and a Github account to sign up for Supabase."),(0,a.yg)("h2",{id:"getting-started"},"Getting Started"),(0,a.yg)("p",null,"Start by creating the Refine app using the ",(0,a.yg)("a",{parentName:"p",href:"https://refine.dev/docs/getting-started/quickstart/"},"create refine-app")," CLI tool."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"npm create refine-app@latest refine-supabase-auth\n")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-bash"},"\u2714 Downloaded remote source successfully.\n\u2714 Choose a project template \xb7 Refine(Vite)\n\u2714 What would you like to name your project?: \xb7 refine-supabase-auth\n\u2714 Choose your backend service to connect: \xb7 Supabase\n\u2714 Do you want to use a UI Framework?: \xb7 no\n\u2714 Do you want to add example pages?: \xb7 no\n\u2714 Do you need i18n (Internationalization) support?: \xb7 no\n\u2714 Choose a package manager: \xb7 npm\n")),(0,a.yg)("br",null),(0,a.yg)("p",null,"Choose the headless option while specifying the UI framework, as you will be integrating tailwind in this tutorial. You can select your preferred package manager; this tutorial will use yarn. Choose the ",(0,a.yg)("inlineCode",{parentName:"p"},"supabase")," option when selecting the Data Provider."),(0,a.yg)("p",null,"Here is the source code of ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/refinedev/refine/tree/main/packages/supabase"},"Refine supabase data provider")),(0,a.yg)("h2",{id:"installing-tailwind-css-for-refine-project"},"Installing Tailwind CSS for Refine project"),(0,a.yg)("p",null,"Next, navigate to your project directory and install the following packages."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"npm install -D tailwindcss postcss autoprefixer\n")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"npm install daisyui react-daisyui\n")),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"https://daisyui.com/"},"Daisy UI")," adds attractive component classes to Tailwind, which are customizable and comes with modular React components like ",(0,a.yg)("inlineCode",{parentName:"p"},"<Button />"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"<Card />"),", etc., out-of-the-box."),(0,a.yg)("p",null,"Run the following command to initialize Tailwind in your project."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"npx tailwindcss init\n")),(0,a.yg)("p",null,"Update the recently added ",(0,a.yg)("inlineCode",{parentName:"p"},"tailwind.config.js")," file to add some theming to the Refine app."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="tailwind.config.js"',title:'"tailwind.config.js"'},'/** @type {import(\'tailwindcss\').Config} */\nexport default {\n  content: [\n    "node_modules/daisyui/dist/**/*.js",\n    "node_modules/react-daisyui/dist/**/*.js",\n    "./src/**/*.{js,jsx,ts,tsx}",\n  ],\n  theme: {\n    extend: {\n      colors: {\n        dark: "#030303",\n        gray: "#eaeaec",\n      },\n    },\n  },\n  plugins: [require("daisyui")],\n  daisyui: {\n    themes: [\n      {\n        mytheme: {\n          primary: "#545bef",\n          secondary: "#757EC0",\n          accent: "#09f08a",\n        },\n      },\n    ],\n  },\n};\n')),(0,a.yg)("p",null,"Create ",(0,a.yg)("inlineCode",{parentName:"p"},"postcss.config.js"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="postcss.config.js"',title:'"postcss.config.js"'},"/** @type {import('tailwindcss').Config} */\nexport default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n};\n")),(0,a.yg)("p",null,"Now, create the ",(0,a.yg)("inlineCode",{parentName:"p"},"App.css")," file and add the following content."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/App.css"',title:'"src/App.css"'},"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n")),(0,a.yg)("p",null,"In the ",(0,a.yg)("inlineCode",{parentName:"p"},"App.tsx")," file, import the ",(0,a.yg)("inlineCode",{parentName:"p"},"App.css")," file to add the styling."),(0,a.yg)("p",null,"Run the ",(0,a.yg)("inlineCode",{parentName:"p"},"npm run dev")," command to start the Refine development server."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"npm run dev\n")),(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/dashboard.jpg",alt:"React Supabase OTP authentication"}),(0,a.yg)("br",null),(0,a.yg)("h2",{id:"set-up-the-supabase-project"},"Set up the Supabase Project"),(0,a.yg)("p",null,'Head over to app.supabase.com and sign in to your Supabase account. Next, create a new project by clicking on the "New Project" button.'),(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/setupSupabase.png",alt:"React Supabase OTP authentication"}),(0,a.yg)("br",null),(0,a.yg)("p",null,"Add the name of the project and the database password, and wait for Supabase to set up and create your project. Meanwhile, you can grab the public key and the project URL from the Supabase dashboard and update the credentials in your code."),(0,a.yg)("p",null,"Once the project is created, go to Authentication -> Settings to configure the Auth providers."),(0,a.yg)("div",{style:{display:"flex"}},(0,a.yg)("img",{style:{alignSelf:"center",width:"50%"},src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/supabase2.png",alt:"React Supabase OTP authentication"}),(0,a.yg)("img",{style:{alignSelf:"center",width:"50%",marginLeft:"8px"},src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/supabase3.jpg",alt:"React Supabase OTP authentication"})),(0,a.yg)("br",null),(0,a.yg)("p",null,"You will find the Phone Auth option in the Auth providers section; enable it and select Twilio as the SMS provider."),(0,a.yg)("br",null),(0,a.yg)("div",{class:"img-container"},(0,a.yg)("div",{class:"window"},(0,a.yg)("div",{class:"control red"}),(0,a.yg)("div",{class:"control orange"}),(0,a.yg)("div",{class:"control green"})),(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/supabase4.png",alt:"React Supabase OTP authentication"})),(0,a.yg)("br",null),(0,a.yg)("p",null,"You need to create and developer account and set up credentials on ",(0,a.yg)("a",{parentName:"p",href:"https://www.twilio.com/"},"Twilio Console")),(0,a.yg)("p",null,"Add your Twilio API credentials to complete the integration. You can also edit the OTP expiry time, length of the OTP, and the SMS template according to your business requirements. For this guide, you can stick with the default values."),(0,a.yg)("p",null,"The backend setup is now complete. In the next section, you will start building the app's frontend."),(0,a.yg)("br",null),(0,a.yg)("div",null,(0,a.yg)("a",{href:"https://s.refine.dev/hackathon2"},(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/hackathon-2/hackathon_cover.png",alt:"React Supabase OTP authentication"}))),(0,a.yg)("h2",{id:"create-the-login-page"},"Create the Login Page"),(0,a.yg)("p",null,"In this guide, you are allowing users to access their account without requiring a password. Once the users log into their account, they will see a list of countries on the dashboard screen."),(0,a.yg)("p",null,"On the login page, you need to create a two-step form.\nIn the first step, the user will enter the mobile number to receive the OTP message, and in the second step, the user will enter the OTP token to log in. Display an error if the OTP token is invalid or expired."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/pages/Login.tsx"',title:'"src/pages/Login.tsx"'},'import { useLogin } from "@refinedev/core";\nimport { useRef, useState } from "react";\nimport { Alert, Button, Card, Input } from "react-daisyui";\nimport { supabaseClient } from "../utility";\n\nexport const LoginPage = () => {\n  const mobileNoRef = useRef<string>();\n  const otpRef = useRef<string>();\n  const [error, setError] = useState<string>();\n  const [formState, setFormState] = useState<"SEND_OTP" | "LOGIN">("SEND_OTP");\n\n  const { mutate: login } = useLogin();\n\n  const onLogin = () => {\n    login(\n      { mobileNo: mobileNoRef.current, otp: otpRef.current },\n      { onError: (error) => setError(error.message) },\n    );\n  };\n\n  const mobileFormRender = () => (\n    <>\n      <label className="text-dark font-medium">Enter your mobile number</label>\n      <Input\n        className="border-gray bg-gray text-dark mb-4 text-lg font-medium"\n        onChange={(e) => (mobileNoRef.current = e.target.value)}\n        onFocus={() => setError("")}\n        name="mobile"\n        type={"tel"}\n        defaultValue={mobileNoRef.current}\n      />\n      <Button color="accent" className="shadow" onClick={onSendOtp}>\n        Send OTP\n      </Button>\n    </>\n  );\n\n  const otpFormRender = () => (\n    <>\n      <label className="text-dark font-medium">Enter OTP</label>\n      <Input\n        className="border-gray bg-gray text-dark mb-4 text-lg font-medium"\n        onChange={(e) => (otpRef.current = e.target.value)}\n        onFocus={() => setError("")}\n        name="otp"\n        value={otpRef.current}\n      />\n      <Button color="accent" className="shadow" onClick={onLogin}>\n        Login\n      </Button>\n    </>\n  );\n\n  const onSendOtp = async () => {\n    const mobileNo = mobileNoRef.current || "";\n    if (!/^\\+[1-9]{1}[0-9]{3,14}$/.test(mobileNo)) {\n      setError("Please enter a valid mobile number");\n      return;\n    }\n\n    const { error } = await supabaseClient.auth.signInWithOtp({\n      phone: mobileNo,\n    });\n    if (error) {\n      setError(error.message);\n      return;\n    }\n    setFormState("LOGIN");\n  };\n\n  return (\n    <div className="bg-primary flex min-h-screen items-center justify-center">\n      <Card className="w-1/2 bg-white shadow-lg " bordered={false}>\n        <Card.Body>\n          {error && (\n            <Alert status="error" className="mb-2">\n              {error}\n            </Alert>\n          )}\n          <h2 className="text-dark mb-3  text-xl font-bold">Sign In</h2>\n          {formState === "SEND_OTP" && mobileFormRender()}\n          {formState === "LOGIN" && otpFormRender()}\n        </Card.Body>\n      </Card>\n    </div>\n  );\n};\n')),(0,a.yg)("p",null,"In the above code, we set a ",(0,a.yg)("inlineCode",{parentName:"p"},"formState")," state variable to define whether to render the mobile input or the OTP input on the screen. If there's any error, set the ",(0,a.yg)("inlineCode",{parentName:"p"},"error")," variable and display it using the ",(0,a.yg)("inlineCode",{parentName:"p"},"<Alert />")," component."),(0,a.yg)("p",null,"Import the ",(0,a.yg)("inlineCode",{parentName:"p"},"<LoginPage />")," component in the ",(0,a.yg)("inlineCode",{parentName:"p"},"App.tsx")," file and create a route for it."),(0,a.yg)("p",null,"To create a route, import the ",(0,a.yg)("inlineCode",{parentName:"p"},"<Route />")," component from ",(0,a.yg)("inlineCode",{parentName:"p"},"react-router-dom")," and pass the ",(0,a.yg)("inlineCode",{parentName:"p"},"<LoginPage />")," component as the ",(0,a.yg)("inlineCode",{parentName:"p"},"children"),". We also use ",(0,a.yg)("inlineCode",{parentName:"p"},"<Authenticated />"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"<Outlet />")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"<NavigateToResource />")," components\nto redirect the user to the home page if they are already logged in."),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"/docs/authentication/auth-provider"},"Refer to the Auth Provider documentation to learn more about authentication. \u2192 ")),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"/docs/packages/list-of-packages"},"Refer to the documentation to learn more routing in ",(0,a.yg)("strong",{parentName:"a"},"Refine")," \u2192 ")),(0,a.yg)("details",null,(0,a.yg)("summary",null,"Show `App.tsx` Code"),(0,a.yg)("p",null,(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="App.tsx"',title:'"App.tsx"'},'// highlight-next-line\nimport { Authenticated, Refine, WelcomePage } from "@refinedev/core";\nimport { RefineKbar, RefineKbarProvider } from "@refinedev/kbar";\n\n// highlight-start\nimport routerBindings, {\n  CatchAllNavigate,\n  DocumentTitleHandler,\n  UnsavedChangesNotifier,\n} from "@refinedev/react-router-v6";\nimport { dataProvider, liveProvider } from "@refinedev/supabase";\nimport {\n  BrowserRouter,\n  Navigate,\n  Outlet,\n  Route,\n  Routes,\n} from "react-router-dom";\n// highlight-end\n\nimport authProvider from "./authProvider";\nimport { supabaseClient } from "./utility";\n\n// highlight-next-line\nimport { LoginPage } from "./pages/Login";\n\nimport "./App.css";\n\nfunction App() {\n  return (\n    <BrowserRouter>\n      <RefineKbarProvider>\n        <Refine\n          dataProvider={dataProvider(supabaseClient)}\n          liveProvider={liveProvider(supabaseClient)}\n          authProvider={authProvider}\n          routerProvider={routerBindings}\n          options={{\n            syncWithLocation: true,\n            warnWhenUnsavedChanges: true,\n          }}\n        >\n          {/* highlight-start */}\n          <Routes>\n            <Route\n              element={\n                <Authenticated fallback={<CatchAllNavigate to="/login" />}>\n                  <Outlet />\n                </Authenticated>\n              }\n            >\n              <Route index element={<WelcomePage />} />\n            </Route>\n            <Route\n              element={\n                <Authenticated fallback={<Outlet />}>\n                  <Navigate to="/" />\n                </Authenticated>\n              }\n            >\n              <Route path="/login" element={<LoginPage />} />\n            </Route>\n          </Routes>\n          {/* highlight-end */}\n          <RefineKbar />\n          <UnsavedChangesNotifier />\n          <DocumentTitleHandler />\n        </Refine>\n      </RefineKbarProvider>\n    </BrowserRouter>\n  );\n}\n\nexport default App;\n')))),(0,a.yg)("p",null,"Also, notice that ",(0,a.yg)("inlineCode",{parentName:"p"},"create refine-app")," has already imported the ",(0,a.yg)("inlineCode",{parentName:"p"},"authProvider")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"dataProvider")," for you."),(0,a.yg)("h2",{id:"data-provider"},"Data Provider"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"dataProvider")," acts as a data layer for your app that makes the HTTP requests and encapsulates how the data is retrieved. It requests and returns the data using predefined methods like ",(0,a.yg)("inlineCode",{parentName:"p"},"create()"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"getMany()"),", etc. ",(0,a.yg)("strong",{parentName:"p"},"Refine")," consumes these methods via data hooks."),(0,a.yg)("p",null,"For example, when you use the ",(0,a.yg)("inlineCode",{parentName:"p"},"useList")," hook, ",(0,a.yg)("strong",{parentName:"p"},"Refine")," internally calls the ",(0,a.yg)("inlineCode",{parentName:"p"},"getList()")," method of the data provider."),(0,a.yg)("p",null,"In this case, we pass the ",(0,a.yg)("inlineCode",{parentName:"p"},"supabaseClient")," as the data provider. Supabase is supported out-of-the-box as a data provider by ",(0,a.yg)("strong",{parentName:"p"},"Refine"),". Here, the data provider internally calls supabase-js database methods like ",(0,a.yg)("inlineCode",{parentName:"p"},"select()"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"insert()"),", etc., to handle the data."),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/core/providers/data-provider/"},"You can learn more about data provider in the Refine docs.")),(0,a.yg)("h2",{id:"auth-provider"},"Auth Provider"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"authProvider")," is an object that Refine uses to authenticate and authorize the users. The auth provider must have methods like ",(0,a.yg)("inlineCode",{parentName:"p"},"login()"),", ",(0,a.yg)("inlineCode",{parentName:"p"},"register()"),", etc., to manage authentication in your app. These methods should return a Promise and are accessible via hooks."),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"create refine-app")," autogenerates the auth provider from your selected preference- in this case, it is Supabase. Unlike data providers, Refine does not offer out-of-the-box support for auth providers; you must create it from scratch."),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"https://refine.dev/docs/api-reference/core/providers/auth-provider/"},"You can read more about auth provider in detail here.")),(0,a.yg)("p",null,"Alright, now coming back to the ",(0,a.yg)("inlineCode",{parentName:"p"},"<LoginPage />")," component. When the user requests for OTP, validate the mobile number using the regex shown in the below code. The mobile number is expected to include the country code; you can use other third-party components for mobile input with a country code dropdown and mobile validation out-of-the-box."),(0,a.yg)("p",null,"We'll use the input field in this guide for brevity."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/pages/Login.tsx"',title:'"src/pages/Login.tsx"'},'import { supabaseClient } from "../utility";\n\n// ...\n\nconst onSendOtp = async () => {\n  const mobileNo = mobileNoRef.current || "";\n  if (!/^\\+[1-9]{1}[0-9]{3,14}$/.test(mobileNo)) {\n    setError("Please enter a valid mobile number");\n    return;\n  }\n\n  const { error } = await supabaseClient.auth.signInWithOtp({\n    phone: mobileNo,\n  });\n  if (error) {\n    setError(error.message);\n    return;\n  }\n  setFormState("LOGIN");\n};\n\n// ...\n')),(0,a.yg)("p",null,"To send the OTP message to the user, use the ",(0,a.yg)("inlineCode",{parentName:"p"},"supabase.auth.signInWithOtp()")," method and pass the mobile number in the ",(0,a.yg)("inlineCode",{parentName:"p"},"phone")," property as shown above."),(0,a.yg)("div",{class:"img-container"},(0,a.yg)("div",{class:"window"},(0,a.yg)("div",{class:"control red"}),(0,a.yg)("div",{class:"control orange"}),(0,a.yg)("div",{class:"control green"})),(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/login.png",alt:"React Supabase OTP authentication"})),(0,a.yg)("br",null),(0,a.yg)("div",{class:"img-container"},(0,a.yg)("div",{class:"window"},(0,a.yg)("div",{class:"control red"}),(0,a.yg)("div",{class:"control orange"}),(0,a.yg)("div",{class:"control green"})),(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/loginInvalid.png",alt:"React Supabase OTP authentication"})),(0,a.yg)("br",null),(0,a.yg)("p",null,"Update the ",(0,a.yg)("inlineCode",{parentName:"p"},"login")," property in ",(0,a.yg)("inlineCode",{parentName:"p"},"authProvider")," to accept the mobile number and OTP as input and call the ",(0,a.yg)("inlineCode",{parentName:"p"},"supabase.auth.verifyOtp()")," method for verifying the OTP entered by the user and enabling access to the dashboard page of the app."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/authProvider.ts"',title:'"src/authProvider.ts"'},'// ...\n\nconst authProvider: AuthProvider = {\n  login: async ({ mobileNo, otp }) => {\n    const { data, error } = await supabaseClient.auth.verifyOtp({\n      type: "sms",\n      phone: mobileNo,\n      token: otp,\n    });\n\n    if (error) {\n      return {\n        success: false,\n        error,\n      };\n    }\n    if (data?.user) {\n      return {\n        success: true,\n        redirectTo: "/",\n      };\n    }\n\n    return {\n      success: false,\n      error: {\n        message: "Login failed",\n        name: "Invalid mobile number or otp",\n      },\n    };\n  },\n  // ...\n};\n')),(0,a.yg)("p",null,"In the ",(0,a.yg)("inlineCode",{parentName:"p"},"onLogin()")," function of the ",(0,a.yg)("inlineCode",{parentName:"p"},"<LoginPage />")," component, pass the mobile number and OTP to the ",(0,a.yg)("inlineCode",{parentName:"p"},"login()")," acquired from the ",(0,a.yg)("inlineCode",{parentName:"p"},"useLogin")," hook."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/pages/Login.tsx"',title:'"src/pages/Login.tsx"'},"// ...\n\nconst { mutate: login } = useLogin();\n\nconst onLogin = () => {\n  login(\n    { mobileNo: mobileNoRef.current, otp: otpRef.current },\n    { onError: (error) => setError(error.message) },\n  );\n};\n")),(0,a.yg)("p",null,"If the OTP is invalid, the error message will be displayed as shown below."),(0,a.yg)("div",{class:"img-container"},(0,a.yg)("div",{class:"window"},(0,a.yg)("div",{class:"control red"}),(0,a.yg)("div",{class:"control orange"}),(0,a.yg)("div",{class:"control green"})),(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/loginToken.png",alt:"React Supabase OTP authentication"})),(0,a.yg)("br",null),(0,a.yg)("p",null,"The authentication flow is now complete. Let\u2019s finish the rest of the app by creating the countries resource."),(0,a.yg)("p",null,"In your Supabase project, head to the SQL editor page and click on the \u201cCountries\u201d option from the Quick start section. It will open up the SQL statements in an editor page; click on the RUN button to execute them."),(0,a.yg)("div",{class:"img-container"},(0,a.yg)("div",{class:"window"},(0,a.yg)("div",{class:"control red"}),(0,a.yg)("div",{class:"control orange"}),(0,a.yg)("div",{class:"control green"})),(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/supabaseDB.png",alt:"React Supabase OTP authentication"})),(0,a.yg)("br",null),(0,a.yg)("div",{class:"img-container"},(0,a.yg)("div",{class:"window"},(0,a.yg)("div",{class:"control red"}),(0,a.yg)("div",{class:"control orange"}),(0,a.yg)("div",{class:"control green"})),(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/supabaseDB2.png",alt:"React Supabase OTP authentication"})),(0,a.yg)("br",null),(0,a.yg)("p",null,"The SQL snippet will create a countries table and dump the country list and other columns like country code and continent."),(0,a.yg)("p",null,"In the ",(0,a.yg)("inlineCode",{parentName:"p"},"<Countries />")," component, get the data from Supabase using the ",(0,a.yg)("inlineCode",{parentName:"p"},"useList")," hook and render the data using the ",(0,a.yg)("inlineCode",{parentName:"p"},"<Table />")," component."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/pages/Countries.tsx"',title:'"src/pages/Countries.tsx"'},'import { useList } from "@refinedev/core";\nimport { Table } from "react-daisyui";\n\nconst columns = ["ID", "Name", "ISO Code", "Local Name", "Continent"];\n\nexport const Countries = () => {\n  const { data: countries } = useList({\n    resource: "countries",\n    hasPagination: false,\n  });\n  return (\n    <div className="overflow-x-auto">\n      <Table color="primary" className="w-full">\n        <Table.Head className="bg-primary">\n          {columns.map((column) => (\n            <span key={column}>{column}</span>\n          ))}\n        </Table.Head>\n        <Table.Body>\n          {countries?.data.map((country: Record<string, string>) => (\n            <Table.Row key={country.id}>\n              <span className="text-dark font-medium opacity-50">\n                {country.id}\n              </span>\n              <span className="text-dark font-medium opacity-50">\n                {country.name}\n              </span>\n              <span className="text-dark font-medium opacity-50">\n                {country.iso2}\n              </span>\n              <span className="text-dark font-medium opacity-50">\n                {country.local_name}\n              </span>\n              <span className="text-dark font-medium opacity-50">\n                {country.continent}\n              </span>\n            </Table.Row>\n          ))}\n        </Table.Body>\n      </Table>\n    </div>\n  );\n};\n')),(0,a.yg)("p",null,"Create the Layout component to create an app bar with a logout button."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/pages/Layout.tsx"',title:'"src/pages/Layout.tsx"'},'import { LayoutProps, useLogout } from "@refinedev/core";\nimport { Button } from "react-daisyui";\n\nexport const Layout: React.FC<LayoutProps> = ({ children }) => {\n  const { mutate: logout } = useLogout();\n  return (\n    <div className="flex min-h-screen flex-col">\n      <div className="bg-gray mb-2 py-3">\n        <div className="container mx-auto flex">\n          <Button\n            color="accent"\n            size="sm"\n            className="ml-auto shadow"\n            onClick={() => logout()}\n          >\n            Logout\n          </Button>\n        </div>\n      </div>\n      <div className="container mx-auto bg-white py-4">{children}</div>\n    </div>\n  );\n};\n')),(0,a.yg)("p",null,"Import the ",(0,a.yg)("inlineCode",{parentName:"p"},"<Countries />")," and the ",(0,a.yg)("inlineCode",{parentName:"p"},"<Layout />")," component in the ",(0,a.yg)("inlineCode",{parentName:"p"},"App.tsx")," file to finish up the application."),(0,a.yg)("details",null,(0,a.yg)("summary",null,"Show `App.tsx` Code"),(0,a.yg)("p",null,(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-tsx",metastring:'title="App.tsx"',title:'"App.tsx"'},'import { Authenticated, Refine } from "@refinedev/core";\nimport { RefineKbar, RefineKbarProvider } from "@refinedev/kbar";\n\nimport routerBindings, {\n  CatchAllNavigate,\n  DocumentTitleHandler,\n  // highlight-next-line\n  NavigateToResource,\n  UnsavedChangesNotifier,\n} from "@refinedev/react-router-v6";\nimport { dataProvider, liveProvider } from "@refinedev/supabase";\nimport { BrowserRouter, Outlet, Route, Routes } from "react-router-dom";\n\nimport { LoginPage } from "./pages/Login";\n// highlight-start\nimport { Countries } from "./pages/Countries";\nimport { Layout } from "./pages/Layout";\n// highlight-end\n\nimport authProvider from "./authProvider";\nimport { supabaseClient } from "./utility";\n\nimport "./App.css";\n\nfunction App() {\n  return (\n    <BrowserRouter>\n      <RefineKbarProvider>\n        <Refine\n          dataProvider={dataProvider(supabaseClient)}\n          liveProvider={liveProvider(supabaseClient)}\n          authProvider={authProvider}\n          routerProvider={routerBindings}\n          options={{\n            syncWithLocation: true,\n            warnWhenUnsavedChanges: true,\n          }}\n          // highlight-next-line\n          resources={[{ name: "countries", list: "/countries" }]}\n        >\n          {/* highlight-start */}\n          <Routes>\n            <Route\n              element={\n                <Authenticated fallback={<CatchAllNavigate to="/login" />}>\n                  <Layout>\n                    <Outlet />\n                  </Layout>\n                </Authenticated>\n              }\n            >\n              <Route\n                index\n                element={<NavigateToResource resource="countries" />}\n              />\n              <Route path="/countries" element={<Countries />} />\n            </Route>\n\n            <Route\n              element={\n                <Authenticated fallback={<Outlet />}>\n                  <NavigateToResource resource="countries" />\n                </Authenticated>\n              }\n            >\n              <Route path="/login" element={<LoginPage />} />\n            </Route>\n          </Routes>\n          {/* highlight-end */}\n          <RefineKbar />\n          <UnsavedChangesNotifier />\n          <DocumentTitleHandler />\n        </Refine>\n      </RefineKbarProvider>\n    </BrowserRouter>\n  );\n}\n\nexport default App;\n')))),(0,a.yg)("div",{class:"img-container"},(0,a.yg)("div",{class:"window"},(0,a.yg)("div",{class:"control red"}),(0,a.yg)("div",{class:"control orange"}),(0,a.yg)("div",{class:"control green"})),(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/blog/2022-09-22-refine-supabase-auth/final.png",alt:"React Supabase OTP authentication"})),(0,a.yg)("br",null),(0,a.yg)("h2",{id:"conclusion"},"Conclusion"),(0,a.yg)("p",null,"OTP authentication adds an extra layer of security to your application and helps ensure that only authorized users can access it. In this article, we've gone over how to add OTP-based authentication in ",(0,a.yg)("strong",{parentName:"p"},"Refine")," using Supabase Auth. We've also looked at how to set up the phone auth provider in Supabase using Twilio so that users can receive their OTP tokens."),(0,a.yg)("p",null,"Following this article's steps, you should now have a ",(0,a.yg)("strong",{parentName:"p"},"Refine")," application with OTP-based authentication enabled."),(0,a.yg)("br",null),(0,a.yg)("div",null,(0,a.yg)("a",{href:"https://discord.gg/refine"},(0,a.yg)("img",{src:"https://refine.ams3.cdn.digitaloceanspaces.com/website/static/img/discord-banner.png",alt:"React Supabase OTP authentication discord banner"}))))}m.isMDXComponent=!0}}]);